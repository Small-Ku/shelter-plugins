(()=>{var V=Object.create;var v=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,K=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var A=(t,e,a)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,D=(t,e)=>{for(var a in e||={})k.call(e,a)&&A(t,a,e[a]);if(U)for(var a of U(e))Q.call(e,a)&&A(t,a,e[a]);return t};var X=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Z=(t,e)=>{for(var a in e)v(t,a,{get:e[a],enumerable:!0})},G=(t,e,a,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of z(e))!k.call(t,o)&&o!==a&&v(t,o,{get:()=>e[o],enumerable:!(s=q(e,o))||s.enumerable});return t};var _=(t,e,a)=>(a=t!=null?V(K(t)):{},G(e||!t||!t.__esModule?v(a,"default",{value:t,enumerable:!0}):a,t)),ee=t=>G(v({},"__esModule",{value:!0}),t);var p=(t,e,a)=>new Promise((s,o)=>{var r=l=>{try{y(a.next(l))}catch(u){o(u)}},n=l=>{try{y(a.throw(l))}catch(u){o(u)}},y=l=>l.done?s(l.value):Promise.resolve(l.value).then(r,n);y((a=a.apply(t,e)).next())});var d=X((ve,L)=>{L.exports=shelter.solidWeb});var fe={};Z(fe,{onLoad:()=>ye,onUnload:()=>ue});var Y=_(d(),1),h=_(d(),1),m=_(d(),1);var S=_(d(),1),f=_(d(),1),w=_(d(),1),C=_(d(),1),W=_(d(),1);var te="https://cdn.discordapp.com";var N=(t,e)=>`${te}/app-assets/${t}/${e}.png`,j=t=>{let a=Date.now()-t,s=Math.floor(a/1e3),o=Math.floor(s/60),r=Math.floor(o/60),n=Math.floor(r/24);return n>0?`${n} day${n>1?"s":""} ago`:r>0?`${r} hour${r>1?"s":""} ago`:o>0?`${o} minute${o>1?"s":""} ago`:"Just now"};var M="._gameCard_1h8rn_1{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;height:72px;border-radius:5px;color:var(--text-normal);margin:12px 0}._gameCard_1h8rn_1._cardNone_1h8rn_1{background-color:var(--primary-400)}._gameCard_1h8rn_1._cardPlaying_1h8rn_1{background-color:var(--green-400)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1{background:rgba(0,0,0,0);border-radius:0;border-bottom:1px solid var(--text-muted)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1 ._gameCardLastPlayed_1h8rn_1{color:var(--text-muted)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1 ._lastPlayedTimestamp_1h8rn_1{font-weight:bold}._gameCardInfo_1h8rn_1{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;width:70%;height:100%;padding:0 20px}._gameCardName_1h8rn_1{font-weight:bold}",c={gameCard:"_gameCard_1h8rn_1",cardNone:"_cardNone_1h8rn_1",cardPlaying:"_cardPlaying_1h8rn_1",cardPlayed:"_cardPlayed_1h8rn_1",gameCardLastPlayed:"_gameCardLastPlayed_1h8rn_1",lastPlayedTimestamp:"_lastPlayedTimestamp_1h8rn_1",gameCardInfo:"_gameCardInfo_1h8rn_1",gameCardName:"_gameCardName_1h8rn_1"};var ae=(0,S.template)("<div><div><span></span><span></span></div><div></div></div>",10),re=(0,S.template)("<span></span>",2),{ui:{injectCss:ne}}=shelter,O=!1,$=t=>(O||(O=!0,ne(M)),(()=>{let e=ae.cloneNode(!0),a=e.firstChild,s=a.firstChild,o=s.nextSibling;return(0,C.insert)(s,()=>t.name||"No game detected"),(0,C.insert)(o,(()=>{let r=(0,W.memo)(()=>t.type==="played");return()=>r()?["Last played: ",(()=>{let n=re.cloneNode(!0);return(0,C.insert)(n,()=>j(t.lastPlayed)),(0,w.effect)(()=>(0,f.className)(n,c.lastPlayedTimestamp)),n})()]:t.type==="playing"?"Now playing!":"What are you playing?"})()),(0,w.effect)(r=>{let n=c.gameCard+" "+(t.type==="playing"?c.cardPlaying:t.type==="played"?c.cardPlayed:c.cardNone),y=c.gameCardInfo,l=c.gameCardName,u=c.gameCardLastPlayed;return n!==r._v$&&(0,f.className)(e,r._v$=n),y!==r._v$2&&(0,f.className)(a,r._v$2=y),l!==r._v$3&&(0,f.className)(s,r._v$3=l),u!==r._v$4&&(0,f.className)(o,r._v$4=u),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e})());var B="._description_1sucy_1{margin-top:8px;margin-bottom:8px}._addIt_1sucy_1{margin-top:8px;margin-bottom:28px}._shead_1sucy_1{margin-bottom:12px}._addhead_1sucy_1{margin-top:42px;margin-bottom:12px}",P={description:"_description_1sucy_1",addIt:"_addIt_1sucy_1",shead:"_shead_1sucy_1",addhead:"_addhead_1sucy_1"};var oe=(0,Y.template)('<a target="_blank">Add it!</a>',2),{ui:{Divider:ie,Header:E,Button:Te,HeaderTags:se,TextBox:Ie,Text:H,injectCss:le},solid:{createSignal:T,createEffect:de},plugin:{store:x}}=shelter,J=!1,F=()=>{J||(J=!0,le(B));let[t,e]=T(!1),[a,s]=T(""),[o,r]=T({});return de(()=>p(void 0,null,function*(){var n;e((yield(n=window==null?void 0:window.__TAURI__)==null?void 0:n.app.getName())==="Dorion"),s(x.currentlyPlaying||""),r(x.previouslyPlayed||{}),setInterval(()=>{s(x.currentlyPlaying||""),r(x.previouslyPlayed||{})},2e3)})),[(0,m.createComponent)(E,{get tag(){return se.H1},get class(){return P.shead},children:"Registered Games"}),(0,m.createComponent)(H,{get class(){return P.description},children:"ShelteRPC will automatically update your status based on the game you're playing (if detectable). You can also manually add games to this list if it isn't being detected."}),(0,m.createComponent)(ie,{mt:20,mb:20}),(0,h.memo)((()=>{let n=(0,h.memo)(()=>!!a());return()=>n()?(0,m.createComponent)($,{get name(){return a()},type:"playing"}):(0,m.createComponent)($,{type:"none"})})()),(0,m.createComponent)(H,{get class(){return P.addIt},get children(){return["Not seeing your game? ",(0,h.memo)(()=>(0,h.memo)(()=>!!t())()?oe.cloneNode(!0):"Adding it is unsupported.")]}}),(0,m.createComponent)(E,{get class(){return P.addhead},children:"Added Games"}),(0,h.memo)(()=>Object.values(o()).map(n=>n.name===a()?null:(0,m.createComponent)($,{get name(){return n.name},get lastPlayed(){return n.lastPlayed},type:"played"})))]};var{flux:{dispatcher:ce,stores:{GameStore:me}},settings:{registerSection:_e},ui:{showToast:I},plugin:{store:g}}=shelter,R=()=>{},i,b={};function pe(t){return p(this,null,function*(){var e;return((e=me.getGameByName(t))==null?void 0:e.name)||"Unknown"})}function ge(t){return p(this,null,function*(){var s,o;let e=JSON.parse(t.data),a=(s=e.activity)==null?void 0:s.assets;if(a!=null&&a.large_image&&(a.large_image=N(e.activity.application_id,a.large_image)),a!=null&&a.small_image&&(a.small_image=N(e.activity.application_id,a.small_image)),e.activity){let r=e.activity.application_id;b[r]||(b[r]=yield pe(e.activity.name));let n=b[r];typeof n!="string"&&((o=e.activity).name||(o.name=n.name)),g.currentlyPlaying=e.activity.name,g.previouslyPlayed||(g.previouslyPlayed={}),e.activity.application_id in g.previouslyPlayed||(g.previouslyPlayed[e.activity.application_id]={}),g.previouslyPlayed[e.activity.application_id]={name:e.activity.name,lastPlayed:Date.now()}}else g.currentlyPlaying="";ce.dispatch(D({type:"LOCAL_ACTIVITY_UPDATE"},e))})}var ye=()=>p(void 0,null,function*(){i&&(i!=null&&i.close)&&i.close(),i=new WebSocket("ws://127.0.0.1:1337"),i.onmessage=ge,i.onerror=e=>console.error(e),(yield new Promise(e=>setTimeout(()=>{i.readyState!==WebSocket.OPEN&&(console.log(i),i==null||i.close(),i=null,I({title:"ShelteRPC",content:"Unable to connect to ShelteRPC server",duration:3e3}),e(!1)),e(!0)},1e3)))&&(i.onclose=()=>{I({title:"ShelteRPC",content:"ShelteRPC server disconnected",duration:3e3})},I({title:"ShelteRPC",content:"Connected to ShelteRPC server",duration:3e3}),R=_e("section","shelterpc","Registered Games",F))}),ue=()=>p(void 0,null,function*(){i==null||i.close(),R&&R()});return ee(fe);})();
