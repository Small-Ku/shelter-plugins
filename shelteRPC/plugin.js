(()=>{var q=Object.create;var v=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,Q=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var k=(t,e,a)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,w=(t,e)=>{for(var a in e||={})D.call(e,a)&&k(t,a,e[a]);if(U)for(var a of U(e))X.call(e,a)&&k(t,a,e[a]);return t};var Z=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ee=(t,e)=>{for(var a in e)v(t,a,{get:e[a],enumerable:!0})},G=(t,e,a,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of K(e))!D.call(t,n)&&n!==a&&v(t,n,{get:()=>e[n],enumerable:!(s=z(e,n))||s.enumerable});return t};var g=(t,e,a)=>(a=t!=null?q(Q(t)):{},G(e||!t||!t.__esModule?v(a,"default",{value:t,enumerable:!0}):a,t)),te=t=>G(v({},"__esModule",{value:!0}),t);var d=(t,e,a)=>new Promise((s,n)=>{var r=l=>{try{y(a.next(l))}catch(u){n(u)}},o=l=>{try{y(a.throw(l))}catch(u){n(u)}},y=l=>l.done?s(l.value):Promise.resolve(l.value).then(r,o);y((a=a.apply(t,e)).next())});var c=Z((Pe,j)=>{j.exports=shelter.solidWeb});var fe={};ee(fe,{onLoad:()=>ue,onUnload:()=>he});var J=g(c(),1),f=g(c(),1),_=g(c(),1);var I=g(c(),1),h=g(c(),1),A=g(c(),1),C=g(c(),1),W=g(c(),1);var{http:ae}=shelter;var N={};var T=(t,e)=>d(void 0,null,function*(){var s;if(!N[t]){let n=yield ae.get(`/oauth2/applications/${t}/assets`);n.status!==200&&console.log("Failed to fetch assets"),N[t]=n.body}return(s=N[t].find(n=>n.name===e))==null?void 0:s.id}),M=t=>{let a=Date.now()-t,s=Math.floor(a/1e3),n=Math.floor(s/60),r=Math.floor(n/60),o=Math.floor(r/24);return o>0?`${o} day${o>1?"s":""} ago`:r>0?`${r} hour${r>1?"s":""} ago`:n>0?`${n} minute${n>1?"s":""} ago`:"Just now"};var O="._gameCard_1h8rn_1{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;height:72px;border-radius:5px;color:var(--text-normal);margin:12px 0}._gameCard_1h8rn_1._cardNone_1h8rn_1{background-color:var(--primary-400)}._gameCard_1h8rn_1._cardPlaying_1h8rn_1{background-color:var(--green-400)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1{background:rgba(0,0,0,0);border-radius:0;border-bottom:1px solid var(--text-muted)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1 ._gameCardLastPlayed_1h8rn_1{color:var(--text-muted)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1 ._lastPlayedTimestamp_1h8rn_1{font-weight:bold}._gameCardInfo_1h8rn_1{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;width:70%;height:100%;padding:0 20px}._gameCardName_1h8rn_1{font-weight:bold}",m={gameCard:"_gameCard_1h8rn_1",cardNone:"_cardNone_1h8rn_1",cardPlaying:"_cardPlaying_1h8rn_1",cardPlayed:"_cardPlayed_1h8rn_1",gameCardLastPlayed:"_gameCardLastPlayed_1h8rn_1",lastPlayedTimestamp:"_lastPlayedTimestamp_1h8rn_1",gameCardInfo:"_gameCardInfo_1h8rn_1",gameCardName:"_gameCardName_1h8rn_1"};var ne=(0,I.template)("<div><div><span></span><span></span></div><div></div></div>",10),re=(0,I.template)("<span></span>",2),{ui:{injectCss:oe}}=shelter,E=!1,x=t=>(E||(E=!0,oe(O)),(()=>{let e=ne.cloneNode(!0),a=e.firstChild,s=a.firstChild,n=s.nextSibling;return(0,C.insert)(s,()=>t.name||"No game detected"),(0,C.insert)(n,(()=>{let r=(0,W.memo)(()=>t.type==="played");return()=>r()?["Last played: ",(()=>{let o=re.cloneNode(!0);return(0,C.insert)(o,()=>M(t.lastPlayed)),(0,A.effect)(()=>(0,h.className)(o,m.lastPlayedTimestamp)),o})()]:t.type==="playing"?"Now playing!":"What are you playing?"})()),(0,A.effect)(r=>{let o=m.gameCard+" "+(t.type==="playing"?m.cardPlaying:t.type==="played"?m.cardPlayed:m.cardNone),y=m.gameCardInfo,l=m.gameCardName,u=m.gameCardLastPlayed;return o!==r._v$&&(0,h.className)(e,r._v$=o),y!==r._v$2&&(0,h.className)(a,r._v$2=y),l!==r._v$3&&(0,h.className)(s,r._v$3=l),u!==r._v$4&&(0,h.className)(n,r._v$4=u),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e})());var B="._description_1sucy_1{margin-top:8px;margin-bottom:8px}._addIt_1sucy_1{margin-top:8px;margin-bottom:28px}._shead_1sucy_1{margin-bottom:12px}._addhead_1sucy_1{margin-top:42px;margin-bottom:12px}",P={description:"_description_1sucy_1",addIt:"_addIt_1sucy_1",shead:"_shead_1sucy_1",addhead:"_addhead_1sucy_1"};var se=(0,J.template)('<a target="_blank">Add it!</a>',2),{ui:{Divider:ie,Header:H,Button:Se,HeaderTags:le,TextBox:Re,Text:Y,injectCss:de},solid:{createSignal:S,createEffect:ce},plugin:{store:$}}=shelter,F=!1,V=()=>{F||(F=!0,de(B));let[t,e]=S(!1),[a,s]=S(""),[n,r]=S({});return ce(()=>d(void 0,null,function*(){var o;e((yield(o=window==null?void 0:window.__TAURI__)==null?void 0:o.app.getName())==="Dorion"),s($.currentlyPlaying||""),r($.previouslyPlayed||{}),setInterval(()=>{s($.currentlyPlaying||""),r($.previouslyPlayed||{})},2e3)})),[(0,_.createComponent)(H,{get tag(){return le.H1},get class(){return P.shead},children:"Registered Games"}),(0,_.createComponent)(Y,{get class(){return P.description},children:"ShelteRPC will automatically update your status based on the game you're playing (if detectable). You can also manually add games to this list if it isn't being detected."}),(0,_.createComponent)(ie,{mt:20,mb:20}),(0,f.memo)((()=>{let o=(0,f.memo)(()=>!!a());return()=>o()?(0,_.createComponent)(x,{get name(){return a()},type:"playing"}):(0,_.createComponent)(x,{type:"none"})})()),(0,_.createComponent)(Y,{get class(){return P.addIt},get children(){return["Not seeing your game? ",(0,f.memo)(()=>(0,f.memo)(()=>!!t())()?se.cloneNode(!0):"Adding it is unsupported.")]}}),(0,_.createComponent)(H,{get class(){return P.addhead},children:"Added Games"}),(0,f.memo)(()=>Object.values(n()).map(o=>o.name===a()?null:(0,_.createComponent)(x,{get name(){return o.name},get lastPlayed(){return o.lastPlayed},type:"played"})))]};var{flux:{dispatcher:me,stores:{GameStore:_e}},settings:{registerSection:ge},ui:{showToast:R},plugin:{store:p},http:Ge}=shelter,L=()=>{},i,b={};function pe(t){return d(this,null,function*(){var e;return((e=_e.getGameByName(t))==null?void 0:e.name)||"Unknown"})}function ye(t){return d(this,null,function*(){var s,n;console.log(t.data);let e=JSON.parse(t.data),a=(s=e.activity)==null?void 0:s.assets;if(a!=null&&a.large_image&&(a.large_image=yield T(e.activity.application_id,a.large_image)),a!=null&&a.small_image&&(a.small_image=yield T(e.activity.application_id,a.small_image)),e.activity){let r=e.activity.application_id;b[r]||(b[r]=yield pe(e.activity.name));let o=b[r];typeof o!="string"&&((n=e.activity).name||(n.name=o.name)),p.currentlyPlaying=e.activity.name,p.previouslyPlayed||(p.previouslyPlayed={}),e.activity.application_id in p.previouslyPlayed||(p.previouslyPlayed[e.activity.application_id]={}),p.previouslyPlayed[e.activity.application_id]={name:e.activity.name,lastPlayed:Date.now()}}else p.currentlyPlaying="";console.log(w({type:"LOCAL_ACTIVITY_UPDATE"},e)),me.dispatch(w({type:"LOCAL_ACTIVITY_UPDATE"},e))})}var ue=()=>d(void 0,null,function*(){i&&(i!=null&&i.close)&&i.close(),i=new WebSocket("ws://127.0.0.1:1337"),i.onmessage=ye,i.onerror=e=>console.error(e),(yield new Promise(e=>setTimeout(()=>{i.readyState!==WebSocket.OPEN&&(console.log(i),i==null||i.close(),i=null,R({title:"ShelteRPC",content:"Unable to connect to ShelteRPC server",duration:3e3}),e(!1)),e(!0)},1e3)))&&(i.onclose=()=>{R({title:"ShelteRPC",content:"ShelteRPC server disconnected",duration:3e3})},R({title:"ShelteRPC",content:"Connected to ShelteRPC server",duration:3e3}),L=ge("section","shelterpc","Registered Games",V))}),he=()=>d(void 0,null,function*(){i==null||i.close(),L&&L()});return te(fe);})();
