(()=>{var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var y=(n,e,t)=>e in n?l(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_=(n,e)=>{for(var t in e||={})S.call(e,t)&&y(n,t,e[t]);if(h)for(var t of h(e))P.call(e,t)&&y(n,t,e[t]);return n};var U=(n,e)=>{for(var t in e)l(n,t,{get:e[t],enumerable:!0})},$=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of C(e))!S.call(n,o)&&o!==t&&l(n,o,{get:()=>e[o],enumerable:!(i=v(e,o))||i.enumerable});return n};var w=n=>$(l({},"__esModule",{value:!0}),n);var p=(n,e,t)=>new Promise((i,o)=>{var s=r=>{try{d(t.next(r))}catch(m){o(m)}},c=r=>{try{d(t.throw(r))}catch(m){o(m)}},d=r=>r.done?i(r.value):Promise.resolve(r.value).then(s,c);d((t=t.apply(n,e)).next())});var O={};U(O,{onLoad:()=>k,onUnload:()=>L});var x="https://cdn.discordapp.com";var u=(n,e)=>`${x}/app-assets/${n}/${e}.png`;var{flux:{dispatcher:A,stores:{GameStore:R}},ui:{showToast:f}}=shelter,a,g={};function T(n){return p(this,null,function*(){var e;return((e=R.getGame(n))==null?void 0:e.name)||"Unknown"})}function b(n){return p(this,null,function*(){var i,o;let e=JSON.parse(n.data),t=(i=e.activity)==null?void 0:i.assets;if(t!=null&&t.large_image&&(t.large_image=u(e.activity.application_id,t.large_image)),t!=null&&t.small_image&&(t.small_image=u(e.activity.application_id,t.small_image)),e.activity){let s=e.activity.application_id;g[s]||(g[s]=yield T(s));let c=g[s];typeof c!="string"&&((o=e.activity).name||(o.name=c.name))}A.dispatch(_({type:"LOCAL_ACTIVITY_UPDATE"},e))})}var k=()=>p(void 0,null,function*(){a&&a.close(),a=new WebSocket("ws://127.0.0.1:1337"),a.onmessage=b,(yield new Promise(e=>setTimeout(()=>{a.readyState!==WebSocket.OPEN&&(a.close(),a=null,f({title:"ShelteRPC",content:"Unable to connect to ShelteRPC server",duration:3e3}),e(!1)),e(!0)},1e3)))&&(a.onclose=()=>{f({title:"ShelteRPC",content:"ShelteRPC server disconnected",duration:3e3})},f({title:"ShelteRPC",content:"Connected to ShelteRPC server",duration:3e3}))}),L=()=>{a.close()};return w(O);})();
