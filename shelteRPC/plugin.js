(()=>{var z=Object.create;var v=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames,A=Object.getOwnPropertySymbols,X=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var U=(t,e,a)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,G=(t,e)=>{for(var a in e||={})D.call(e,a)&&U(t,a,e[a]);if(A)for(var a of A(e))Z.call(e,a)&&U(t,a,e[a]);return t};var ee=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),te=(t,e)=>{for(var a in e)v(t,a,{get:e[a],enumerable:!0})},L=(t,e,a,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Q(e))!D.call(t,r)&&r!==a&&v(t,r,{get:()=>e[r],enumerable:!(s=K(e,r))||s.enumerable});return t};var c=(t,e,a)=>(a=t!=null?z(X(t)):{},L(e||!t||!t.__esModule?v(a,"default",{value:t,enumerable:!0}):a,t)),ae=t=>L(v({},"__esModule",{value:!0}),t);var g=(t,e,a)=>new Promise((s,r)=>{var o=l=>{try{y(a.next(l))}catch(u){r(u)}},n=l=>{try{y(a.throw(l))}catch(u){r(u)}},y=l=>l.done?s(l.value):Promise.resolve(l.value).then(o,n);y((a=a.apply(t,e)).next())});var d=ee(($e,j)=>{j.exports=shelter.solidWeb});var Pe={};te(Pe,{generateAssetId:()=>k,onLoad:()=>fe,onUnload:()=>ve});var B=c(d(),1),V=c(d(),1),f=c(d(),1),_=c(d(),1);var N=c(d(),1),h=c(d(),1),w=c(d(),1),C=c(d(),1),W=c(d(),1);var E=t=>{let a=Date.now()-t,s=Math.floor(a/1e3),r=Math.floor(s/60),o=Math.floor(r/60),n=Math.floor(o/24);return n>0?`${n} day${n>1?"s":""} ago`:o>0?`${o} hour${o>1?"s":""} ago`:r>0?`${r} minute${r>1?"s":""} ago`:"Just now"};var M="._gameCard_1h8rn_1{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;height:72px;border-radius:5px;color:var(--text-normal);margin:12px 0}._gameCard_1h8rn_1._cardNone_1h8rn_1{background-color:var(--primary-400)}._gameCard_1h8rn_1._cardPlaying_1h8rn_1{background-color:var(--green-400)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1{background:rgba(0,0,0,0);border-radius:0;border-bottom:1px solid var(--text-muted)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1 ._gameCardLastPlayed_1h8rn_1{color:var(--text-muted)}._gameCard_1h8rn_1._cardPlayed_1h8rn_1 ._lastPlayedTimestamp_1h8rn_1{font-weight:bold}._gameCardInfo_1h8rn_1{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;width:70%;height:100%;padding:0 20px}._gameCardName_1h8rn_1{font-weight:bold}",m={gameCard:"_gameCard_1h8rn_1",cardNone:"_cardNone_1h8rn_1",cardPlaying:"_cardPlaying_1h8rn_1",cardPlayed:"_cardPlayed_1h8rn_1",gameCardLastPlayed:"_gameCardLastPlayed_1h8rn_1",lastPlayedTimestamp:"_lastPlayedTimestamp_1h8rn_1",gameCardInfo:"_gameCardInfo_1h8rn_1",gameCardName:"_gameCardName_1h8rn_1"};var ne=(0,N.template)("<div><div><span></span><span></span></div><div></div></div>",10),re=(0,N.template)("<span></span>",2),{ui:{injectCss:oe}}=shelter,O=!1,$=t=>(O||(O=!0,oe(M)),(()=>{let e=ne.cloneNode(!0),a=e.firstChild,s=a.firstChild,r=s.nextSibling;return(0,C.insert)(s,()=>t.name||"No game detected"),(0,C.insert)(r,(()=>{let o=(0,W.memo)(()=>t.type==="played");return()=>o()?["Last played: ",(()=>{let n=re.cloneNode(!0);return(0,C.insert)(n,()=>E(t.lastPlayed)),(0,w.effect)(()=>(0,h.className)(n,m.lastPlayedTimestamp)),n})()]:t.type==="playing"?"Now playing!":"What are you playing?"})()),(0,w.effect)(o=>{let n=m.gameCard+" "+(t.type==="playing"?m.cardPlaying:t.type==="played"?m.cardPlayed:m.cardNone),y=m.gameCardInfo,l=m.gameCardName,u=m.gameCardLastPlayed;return n!==o._v$&&(0,h.className)(e,o._v$=n),y!==o._v$2&&(0,h.className)(a,o._v$2=y),l!==o._v$3&&(0,h.className)(s,o._v$3=l),u!==o._v$4&&(0,h.className)(r,o._v$4=u),o},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e})());var H="._description_1sucy_1{margin-top:8px;margin-bottom:8px}._addIt_1sucy_1{margin-top:8px;margin-bottom:28px}._shead_1sucy_1{margin-bottom:12px}._addhead_1sucy_1{margin-top:42px;margin-bottom:12px}",P={description:"_description_1sucy_1",addIt:"_addIt_1sucy_1",shead:"_shead_1sucy_1",addhead:"_addhead_1sucy_1"};var se=(0,B.template)('<a target="_blank">Add it!</a>',2),{ui:{Divider:ie,Header:F,HeaderTags:le,Text:J,injectCss:de,showToast:ce},solid:{createSignal:S,createEffect:me},plugin:{store:x}}=shelter,Y=!1,q=()=>{Y||(Y=!0,de(H));let[t,e]=S(!1),[a,s]=S(""),[r,o]=S({});return me(()=>g(void 0,null,function*(){var n;e((yield(n=window==null?void 0:window.__TAURI__)==null?void 0:n.app.getName())==="Dorion"),s(x.currentlyPlaying||""),o(x.previouslyPlayed||{}),setInterval(()=>{s(x.currentlyPlaying||""),o(x.previouslyPlayed||{})},2e3)})),[(0,_.createComponent)(F,{get tag(){return le.H1},get class(){return P.shead},children:"Registered Games"}),(0,_.createComponent)(J,{get class(){return P.description},children:"ShelteRPC will automatically update your status based on the game you're playing (if detectable). You can also manually add games to this list if it isn't being detected."}),(0,_.createComponent)(ie,{mt:20,mb:20}),(0,f.memo)((()=>{let n=(0,f.memo)(()=>!!a());return()=>n()?(0,_.createComponent)($,{get name(){return a()},type:"playing"}):(0,_.createComponent)($,{type:"none"})})()),(0,_.createComponent)(J,{get class(){return P.addIt},get children(){return["Not seeing your game? ",(0,f.memo)(()=>(0,f.memo)(()=>!!t())()?(()=>{let n=se.cloneNode(!0);return n.$$click=()=>{ce({title:"ShelteRPC",content:"This is not implemented yet!",duration:4e3})},n})():"Adding it is unsupported.")]}}),(0,_.createComponent)(F,{get class(){return P.addhead},children:"Added Games"}),(0,f.memo)(()=>Object.values(r()).map(n=>n.name===a()?null:(0,_.createComponent)($,{get name(){return n.name},get lastPlayed(){return n.lastPlayed},type:"played"})))]};(0,V.delegateEvents)(["click"]);var{flux:{dispatcher:_e,stores:{GameStore:ge}},settings:{registerSection:pe},ui:{showToast:T},plugin:{store:p},http:ye}=shelter,I=()=>{},R={},i,b={};function ue(t){return g(this,null,function*(){var e;return((e=ge.getGameByName(t))==null?void 0:e.name)||"Unknown"})}var k=(t,e)=>g(void 0,null,function*(){var s;if(!R[t]){let r=yield ye.get(`/oauth2/applications/${t}/assets`);r.status!==200&&console.log("Failed to fetch assets"),R[t]=r.body}return(s=R[t].find(r=>r.name===e))==null?void 0:s.id});function he(t){return g(this,null,function*(){var s,r;let e=JSON.parse(t.data),a=(s=e.activity)==null?void 0:s.assets;if(a!=null&&a.large_image&&(a.large_image=yield k(e.activity.application_id,a.large_image)),a!=null&&a.small_image&&(a.small_image=yield k(e.activity.application_id,a.small_image)),e.activity){let o=e.activity.application_id;b[o]||(b[o]=yield ue(e.activity.name));let n=b[o];typeof n!="string"&&((r=e.activity).name||(r.name=n.name)),p.currentlyPlaying=e.activity.name,p.previouslyPlayed||(p.previouslyPlayed={}),e.activity.application_id in p.previouslyPlayed||(p.previouslyPlayed[e.activity.application_id]={}),p.previouslyPlayed[e.activity.application_id]={name:e.activity.name,lastPlayed:Date.now()}}else p.currentlyPlaying="";_e.dispatch(G({type:"LOCAL_ACTIVITY_UPDATE"},e))})}var fe=()=>g(void 0,null,function*(){i&&(i!=null&&i.close)&&i.close(),i=new WebSocket("ws://127.0.0.1:1337"),i.onmessage=he,i.onerror=e=>console.error(e),(yield new Promise(e=>setTimeout(()=>{i.readyState!==WebSocket.OPEN&&(console.log(i),i==null||i.close(),i=null,T({title:"ShelteRPC",content:"Unable to connect to ShelteRPC server",duration:3e3}),e(!1)),e(!0)},1e3)))&&(i.onclose=()=>{T({title:"ShelteRPC",content:"ShelteRPC server disconnected",duration:3e3})},T({title:"ShelteRPC",content:"Connected to ShelteRPC server",duration:3e3}),I=pe("section","shelterpc","Registered Games",q))}),ve=()=>g(void 0,null,function*(){i==null||i.close(),I&&I()});return ae(Pe);})();
