(()=>{var fe=Object.create;var P=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames,B=Object.getOwnPropertySymbols,xe=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var W=(e,t,a)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,F=(e,t)=>{for(var a in t||={})Z.call(t,a)&&W(e,a,t[a]);if(B)for(var a of B(t))Ce.call(t,a)&&W(e,a,t[a]);return e};var be=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Pe=(e,t)=>{for(var a in t)P(e,a,{get:t[a],enumerable:!0})},Y=(e,t,a,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of $e(t))!Z.call(e,n)&&n!==a&&P(e,n,{get:()=>t[n],enumerable:!(r=ve(t,n))||r.enumerable});return e};var m=(e,t,a)=>(a=e!=null?fe(xe(e)):{},Y(t||!e||!e.__esModule?P(a,"default",{value:e,enumerable:!0}):a,e)),je=e=>Y(P({},"__esModule",{value:!0}),e);var y=(e,t,a)=>new Promise((r,n)=>{var l=s=>{try{i(a.next(s))}catch(g){n(g)}},o=s=>{try{i(a.throw(s))}catch(g){n(g)}},i=s=>s.done?r(s.value):Promise.resolve(s.value).then(l,o);i((a=a.apply(e,t)).next())});var d=be((nt,J)=>{J.exports=shelter.solidWeb});var tt={};Pe(tt,{generateAssetId:()=>O,onLoad:()=>Xe,onUnload:()=>et});var _e=m(d(),1),ge=m(d(),1),f=m(d(),1),_=m(d(),1);var k=m(d(),1),ee=m(d(),1),p=m(d(),1),N=m(d(),1),x=m(d(),1),M=m(d(),1);var q=e=>{let a=Date.now()-e,r=Math.floor(a/1e3),n=Math.floor(r/60),l=Math.floor(n/60),o=Math.floor(l/24);return o>0?`${o} day${o>1?"s":""} ago`:l>0?`${l} hour${l>1?"s":""} ago`:n>0?`${n} minute${n>1?"s":""} ago`:"Just now"};var K="._gameCard_jydgh_1{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;height:72px;border-radius:5px;color:var(--text-normal);margin:12px 0}._gameCard_jydgh_1._cardNone_jydgh_1{background-color:var(--primary-400)}._gameCard_jydgh_1._cardPlaying_jydgh_1{background-color:var(--green-400)}._gameCard_jydgh_1._cardPlayed_jydgh_1{background:rgba(0,0,0,0);border-radius:0;border-bottom:1px solid var(--text-muted)}._gameCard_jydgh_1._cardPlayed_jydgh_1 ._gameCardLastPlayed_jydgh_1{color:var(--text-muted)}._gameCard_jydgh_1._cardPlayed_jydgh_1 ._lastPlayedTimestamp_jydgh_1{font-weight:bold}._gameCardInfo_jydgh_1{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;width:70%;height:100%;padding:0 20px}._gameCardName_jydgh_1{font-weight:bold}._gameCardIcons_jydgh_1{display:flex;flex-direction:row;align-items:center;justify-content:flex-end;height:100%;padding:0 20px;color:var(--text-muted)}._gameCardIcons_jydgh_1 span{margin:4px;width:24px;height:24px;cursor:pointer}._gameCardIcons_jydgh_1 span:hover{color:var(--text-normal)}._gameCardIcons_jydgh_1 span svg{width:100%;height:100%}._trash_jydgh_1:hover{color:var(--text-danger) !important}",u={gameCard:"_gameCard_jydgh_1",cardNone:"_cardNone_jydgh_1",cardPlaying:"_cardPlaying_jydgh_1",cardPlayed:"_cardPlayed_jydgh_1",gameCardLastPlayed:"_gameCardLastPlayed_jydgh_1",lastPlayedTimestamp:"_lastPlayedTimestamp_jydgh_1",gameCardInfo:"_gameCardInfo_jydgh_1",gameCardName:"_gameCardName_jydgh_1",gameCardIcons:"_gameCardIcons_jydgh_1",trash:"_trash_jydgh_1"};var we=(0,k.template)('<svg class="icon_f09dde" aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M15 3.999V2H9V3.999H3V5.999H21V3.999H15Z"></path><path fill="currentColor" d="M5 6.99902V18.999C5 20.101 5.897 20.999 7 20.999H17C18.103 20.999 19 20.101 19 18.999V6.99902H5ZM11 17H9V11H11V17ZM15 17H13V11H15V17Z"></path></svg>',6),Ne=(0,k.template)("<div><div><span></span><span></span></div><div></div></div>",10),Q=(0,k.template)("<span></span>",2),{ui:{injectCss:ke},plugin:{store:j}}=shelter,Ie=()=>we.cloneNode(!0),X=!1,Se=e=>{window.dorion&&window.__TAURI__.event.emit("remove_detectable",{name:e,exe:""});let t=Object.keys(j.previouslyPlayed).find(a=>j.previouslyPlayed[a].name===e);delete j.previouslyPlayed[t],j.currentlyPlaying===e&&(j.currentlyPlaying="")},I=e=>(X||(X=!0,ke(K)),(()=>{let t=Ne.cloneNode(!0),a=t.firstChild,r=a.firstChild,n=r.nextSibling,l=a.nextSibling;return(0,x.insert)(r,()=>e.name||"No game detected"),(0,x.insert)(n,(()=>{let o=(0,M.memo)(()=>e.type==="played");return()=>o()?["Last played: ",(()=>{let i=Q.cloneNode(!0);return(0,x.insert)(i,()=>q(e.lastPlayed)),(0,N.effect)(()=>(0,p.className)(i,u.lastPlayedTimestamp)),i})()]:e.type==="playing"&&e.name?"Now playing!":"What are you playing?"})()),(0,x.insert)(l,(()=>{let o=(0,M.memo)(()=>!!e.local);return()=>o()&&(()=>{let i=Q.cloneNode(!0);return i.$$click=()=>{Se(e.name||"")},(0,x.insert)(i,Ie),(0,N.effect)(()=>(0,p.className)(i,u.trash)),i})()})()),(0,N.effect)(o=>{let i=u.gameCard+" "+(e.type==="playing"&&e.name?u.cardPlaying:e.type==="played"?u.cardPlayed:u.cardNone),s=u.gameCardInfo,g=u.gameCardName,$=u.gameCardLastPlayed,b=u.gameCardIcons;return i!==o._v$&&(0,p.className)(t,o._v$=i),s!==o._v$2&&(0,p.className)(a,o._v$2=s),g!==o._v$3&&(0,p.className)(r,o._v$3=g),$!==o._v$4&&(0,p.className)(n,o._v$4=$),b!==o._v$5&&(0,p.className)(l,o._v$5=b),o},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t})());(0,ee.delegateEvents)(["click"]);var V=m(d(),1),A=m(d(),1),H=m(d(),1),se=m(d(),1),T=m(d(),1),le=m(d(),1),w=m(d(),1);var te="._ddown_ccz23_1{box-sizing:border-box;font-size:16px;width:100%;border-radius:3px;color:var(--text-normal);background-color:var(--input-background);border:none;transition:border-color .2s ease-in-out;padding:10px;appearance:none;cursor:pointer}._dcontainer_ccz23_1{position:relative;width:100%}._dsarrow_ccz23_1{position:absolute;right:10px;top:50%;transform:translateY(-50%);pointer-events:none}._dsarrow_ccz23_1 path{fill:var(--text-secondary)}",S={ddown:"_ddown_ccz23_1",dcontainer:"_dcontainer_ccz23_1",dsarrow:"_dsarrow_ccz23_1"};var ae=m(d(),1),ne=m(d(),1),re=m(d(),1),Ae=(0,ae.template)('<svg aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M16.59 8.59003L12 13.17L7.41 8.59003L6 10L12 16L18 10L16.59 8.59003Z"></path></svg>',4),oe=e=>(()=>{let t=Ae.cloneNode(!0);return(0,re.effect)(()=>(0,ne.setAttribute)(t,"class",e.class)),t})();var Te=(0,V.template)("<div><select></select></div>",4),Le=(0,V.template)("<option></option>",2),{ui:{injectCss:Re}}=shelter,ie=!1,de=e=>(ie||(ie=!0,Re(te)),(()=>{let t=Te.cloneNode(!0),a=t.firstChild;return(0,le.addEventListener)(a,"change",e.onChange),(0,T.insert)(a,()=>{var r;return(r=e.options)==null?void 0:r.map(n=>(()=>{let l=Le.cloneNode(!0);return(0,T.insert)(l,()=>n.label),(0,w.effect)(()=>l.selected=n.value===(e==null?void 0:e.selected)),(0,w.effect)(()=>l.value=n.value),l})())}),(0,T.insert)(t,(0,se.createComponent)(oe,{get class(){return S.dsarrow}}),null),(0,w.effect)(r=>{let n=S.dcontainer,l=S.ddown,o=e.placeholder,i=e.id,s=e["aria-label"];return n!==r._v$&&(0,H.className)(t,r._v$=n),l!==r._v$2&&(0,H.className)(a,r._v$2=l),o!==r._v$3&&(0,A.setAttribute)(a,"placeholder",r._v$3=o),i!==r._v$4&&(0,A.setAttribute)(a,"id",r._v$4=i),s!==r._v$5&&(0,A.setAttribute)(a,"aria-label",r._v$5=s),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),(0,w.effect)(()=>a.value=e.value),t})());var ce="._description_1kj0u_1{margin-top:8px;margin-bottom:8px}._addIt_1kj0u_1{margin-top:8px;margin-bottom:28px}._shead_1kj0u_1{margin-bottom:12px}._addhead_1kj0u_1{margin-top:42px;margin-bottom:12px}._modalhead_1kj0u_1{margin-top:12px}",C={description:"_description_1kj0u_1",addIt:"_addIt_1kj0u_1",shead:"_shead_1kj0u_1",addhead:"_addhead_1kj0u_1",modalhead:"_modalhead_1kj0u_1"};var Me=(0,_e.template)('<a target="_blank">Add it!</a>',2),{ui:{Divider:He,Header:D,HeaderTags:Ve,Text:U,TextBox:De,injectCss:Ue,openModal:Ee,ModalRoot:ze,ModalHeader:Ge,ModalBody:Oe,ModalConfirmFooter:Be},solid:{createSignal:v,createEffect:ue},plugin:{store:L}}=shelter,{invoke:ye,event:We}=window.__TAURI__,me=!1,pe=()=>{me||(me=!0,Ue(ce));let[e,t]=v(!1),[a,r]=v(""),[n,l]=v({}),[o,i]=v([]);return ue(()=>y(void 0,null,function*(){var g;t((yield(g=window==null?void 0:window.__TAURI__)==null?void 0:g.app.getName())==="Dorion"),r(L.currentlyPlaying||""),l(L.previouslyPlayed||{}),i(e&&(yield ye("get_local_detectables")));let s=()=>{for(let $ of o()){let b=Object.values(n()).findIndex(he=>he.name===$.name);b!==-1&&(n()[Object.keys(n())[b]].local=!0)}};s(),setInterval(()=>{r(L.currentlyPlaying||""),l(L.previouslyPlayed||{}),s()},2e3)})),[(0,_.createComponent)(D,{get tag(){return Ve.H1},get class(){return C.shead},children:"Registered Games"}),(0,_.createComponent)(U,{get class(){return C.description},children:"ShelteRPC will automatically update your status based on the game you're playing (if detectable). You can also manually add games to this list if it isn't being detected."}),(0,_.createComponent)(He,{mt:20,mb:20}),(0,f.memo)((()=>{let s=(0,f.memo)(()=>!!a());return()=>s()?(0,_.createComponent)(I,{get name(){return a()},type:"playing",get local(){var g;return((g=Object.values(n()).find($=>$.name===a()))==null?void 0:g.local)||!1}}):(0,_.createComponent)(I,{type:"none"})})()),(0,_.createComponent)(U,{get class(){return C.addIt},get children(){return["Not seeing your game? ",(0,f.memo)(()=>(0,f.memo)(()=>!!e())()?(()=>{let s=Me.cloneNode(!0);return s.$$click=Ze,s})():"Adding it is unsupported.")]}}),(0,_.createComponent)(D,{get class(){return C.addhead},children:"Added Games"}),(0,f.memo)(()=>Object.values(n()).map(s=>s.name===a()?null:(0,_.createComponent)(I,{get name(){return s.name},get lastPlayed(){return s.lastPlayed},type:"played",get local(){return s.local}})))]};function Ze(){let[e,t]=v([]),[a,r]=v(0),[n,l]=v("");ue(()=>y(this,null,function*(){let o=yield ye("get_windows");t(o)})),Ee(o=>(0,_.createComponent)(ze,{get children(){return[(0,_.createComponent)(Ge,{get close(){return o.close},children:"Add a game"}),(0,_.createComponent)(Oe,{get children(){return(0,f.memo)(()=>e().length>0)()?[(0,_.createComponent)(de,{get options(){return e().map(i=>({label:i.process_name,value:i.pid}))},placeholder:"Select process...",maxVisibleItems:5,closeOnSelect:!0,onChange:i=>r(Number(i.target.value))}),(0,_.createComponent)(D,{get class(){return C.modalhead},children:"Name to Display"}),(0,_.createComponent)(De,{get value(){return n()},onInput:i=>l(i),placeholder:"Enter the name to display..."})]:(0,_.createComponent)(U,{children:"Please wait..."})}}),(0,_.createComponent)(Be,{onConfirm:()=>{var i;We.emit("add_detectable",{exe:(i=e().find(s=>s.pid===a()))==null?void 0:i.process_name,name:n()})},get onCancel(){return o.close},confirmText:"Add",cancelText:"Cancel",type:"neutral"})]}}))}(0,ge.delegateEvents)(["click"]);var{flux:{dispatcher:Fe,stores:{GameStore:Ye}},settings:{registerSection:Je},ui:{showToast:E},plugin:{store:h},http:qe}=shelter,G=()=>{},z={},c,R={};h.currentlyPlaying="";function Ke(e){return y(this,null,function*(){var t;return((t=Ye.getGameByName(e))==null?void 0:t.name)||"Unknown"})}var O=(e,t)=>y(void 0,null,function*(){var r;if(!z[e]){let n=yield qe.get(`/oauth2/applications/${e}/assets`);n.status!==200&&console.log("Failed to fetch assets"),z[e]=n.body}return(r=z[e].find(n=>n.name===t))==null?void 0:r.id});function Qe(e){return y(this,null,function*(){var r,n;let t=JSON.parse(e.data),a=(r=t.activity)==null?void 0:r.assets;if(a!=null&&a.large_image&&(a.large_image=yield O(t.activity.application_id,a.large_image)),a!=null&&a.small_image&&(a.small_image=yield O(t.activity.application_id,a.small_image)),t.activity){let l=t.activity.application_id;R[l]||(R[l]=yield Ke(t.activity.name));let o=R[l];typeof o!="string"&&((n=t.activity).name||(n.name=o.name)),h.currentlyPlaying=t.activity.name,h.previouslyPlayed||(h.previouslyPlayed={}),t.activity.application_id in h.previouslyPlayed||(h.previouslyPlayed[t.activity.application_id]={}),h.previouslyPlayed[t.activity.application_id]={name:t.activity.name,lastPlayed:Date.now()}}else h.currentlyPlaying="";Fe.dispatch(F({type:"LOCAL_ACTIVITY_UPDATE"},t))})}var Xe=()=>y(void 0,null,function*(){c&&(c!=null&&c.close)&&c.close(),c=new WebSocket("ws://127.0.0.1:1337"),c.onmessage=Qe,c.onerror=t=>console.error(t);let e=yield new Promise(t=>setTimeout(()=>{c.readyState!==WebSocket.OPEN&&(console.log(c),c==null||c.close(),c=null,E({title:"ShelteRPC",content:"Unable to connect to ShelteRPC server",duration:3e3}),t(!1)),t(!0)},1e3));G=Je("section","shelterpc","Registered Games",pe),e&&(c.onclose=()=>{E({title:"ShelteRPC",content:"ShelteRPC server disconnected",duration:3e3})},E({title:"ShelteRPC",content:"Connected to ShelteRPC server",duration:3e3}))}),et=()=>y(void 0,null,function*(){var e;c!=null&&c.close&&((e=c.close)==null||e.call(c)),G&&G()});return je(tt);})();
